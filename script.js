var w = window.innerHeight
var h = window.innerWidth 
let t = 0
var points = []
var s = 1
var xoff = 0
var yoff = 0
var startX = 0
var startY = 0
var frame = 0
var fr = 0

var pmatrix = true
var mmatrix = $("#mmatrix").is(":checked")

// Just the raw data I copied and pasted, hopefully the person who's reading this has an IDE that shrinks down large segmets like this
// I could have put this in a different file, but I don't want to figure out CORS errors

{
var data = `1   1.40000   0.00000   2.40000
2   1.40000  -0.78400   2.40000
3   0.78000  -1.40000   2.40000
4   0.00000  -1.40000   2.40000
5   1.33750   0.00000   2.53125
6   1.33750  -0.74900   2.53125
7   0.74900  -1.33750   2.53125
8   0.00000  -1.33750   2.53125
9   1.43750   0.00000   2.53125
10   1.43750  -0.80500   2.53125
11   0.80500  -1.43750   2.53125
12   0.00000  -1.43750   2.53125
13   1.50000   0.00000   2.40000
14   1.50000  -0.84000   2.40000
15   0.84000  -1.50000   2.40000
16   0.00000  -1.50000   2.40000
17  -0.78400  -1.40000   2.40000
18  -1.40000  -0.78400   2.40000
19  -1.40000   0.00000   2.40000
20  -0.74900  -1.33750   2.53125
21  -1.33750  -0.74900   2.53125
22  -1.33750   0.00000   2.53125
23  -0.80500  -1.43750   2.53125
24  -1.43750  -0.80500   2.53125
25  -1.43750   0.00000   2.53125
26  -0.84000  -1.50000   2.40000
27  -1.50000  -0.84000   2.40000
28  -1.50000   0.00000   2.40000
29  -1.40000   0.78400   2.40000
30  -0.78400   1.40000   2.40000
31   0.00000   1.40000   2.40000
32  -1.33750   0.74900   2.53125
33  -0.74900   1.33750   2.53125
34   0.00000   1.33750   2.53125
35  -1.43750   0.80500   2.53125
36  -0.80500   1.43750   2.53125
37   0.00000   1.43750   2.53125
38  -1.50000   0.84000   2.40000
39  -0.84000   1.50000   2.40000
40   0.00000   1.50000   2.40000
41   0.78400   1.40000   2.40000
42   1.40000   0.78400   2.40000
43   0.74900   1.33750   2.53125
44   1.33750   0.74900   2.53125
45   0.80500   1.43750   2.53125
46   1.43750   0.80500   2.53125
47   0.84000   1.50000   2.40000
48   1.50000   0.84000   2.40000
49   1.75000   0.00000   1.87500
50   1.75000  -0.98000   1.87500
51   0.98000  -1.75000   1.87500
52   0.00000  -1.75000   1.87500
53   2.00000   0.00000   1.35000
54   2.00000  -1.12000   1.35000
55   1.12000  -2.00000   1.35000
56   0.00000  -2.00000   1.35000
57   2.00000   0.00000   0.90000
58   2.00000  -1.12000   0.90000
59   1.12000  -2.00000   0.90000
60   0.00000  -2.00000   0.90000
61  -0.98000  -1.75000   1.87500
62  -1.75000  -0.98000   1.87500
63  -1.75000   0.00000   1.87500
64  -1.12000  -2.00000   1.35000
65  -2.00000  -1.12000   1.35000
66  -2.00000   0.00000   1.35000
67  -1.12000  -2.00000   0.90000
68  -2.00000  -1.12000   0.90000
69  -2.00000   0.00000   0.90000
70  -1.75000   0.98000   1.87500
71  -0.98000   1.75000   1.87500
72   0.00000   1.75000   1.87500
73  -2.00000   1.12000   1.35000
74  -1.12000   2.00000   1.35000
75   0.00000   2.00000   1.35000
76  -2.00000   1.12000   0.90000
77  -1.12000   2.00000   0.90000
78   0.00000   2.00000   0.90000
79   0.98000   1.75000   1.87500
80   1.75000   0.98000   1.87500
81   1.12000   2.00000   1.35000
82   2.00000   1.12000   1.35000
83   1.12000   2.00000   0.90000
84   2.00000   1.12000   0.90000
85   2.00000   0.00000   0.45000
86   2.00000  -1.12000   0.45000
87   1.12000  -2.00000   0.45000
88   0.00000  -2.00000   0.45000
89   1.50000   0.00000   0.22500
90   1.50000  -0.84000   0.22500
91   0.84000  -1.50000   0.22500
92   0.00000  -1.50000   0.22500
93   1.50000   0.00000   0.15000
94   1.50000  -0.84000   0.15000
95   0.84000  -1.50000   0.15000
96   0.00000  -1.50000   0.15000
97  -1.12000  -2.00000   0.45000
98  -2.00000  -1.12000   0.45000
99  -2.00000   0.00000   0.45000
100  -0.84000  -1.50000   0.22500
101  -1.50000  -0.84000   0.22500
102  -1.50000   0.00000   0.22500
103  -0.84000  -1.50000   0.15000
104  -1.50000  -0.84000   0.15000
105  -1.50000   0.00000   0.15000
106  -2.00000   1.12000   0.45000
107  -1.12000   2.00000   0.45000
108   0.00000   2.00000   0.45000
109  -1.50000   0.84000   0.22500
110  -0.84000   1.50000   0.22500
111   0.00000   1.50000   0.22500
112  -1.50000   0.84000   0.15000
113  -0.84000   1.50000   0.15000
114   0.00000   1.50000   0.15000
115   1.12000   2.00000   0.45000
116   2.00000   1.12000   0.45000
117   0.84000   1.50000   0.22500
118   1.50000   0.84000   0.22500
119   0.84000   1.50000   0.15000
120   1.50000   0.84000   0.15000
121  -1.60000   0.00000   2.02500
122  -1.60000  -0.30000   2.02500
123  -1.50000  -0.30000   2.25000
124  -1.50000   0.00000   2.25000
125  -2.30000   0.00000   2.02500
126  -2.30000  -0.30000   2.02500
127  -2.50000  -0.30000   2.25000
128  -2.50000   0.00000   2.25000
129  -2.70000   0.00000   2.02500
130  -2.70000  -0.30000   2.02500
131  -3.00000  -0.30000   2.25000
132  -3.00000   0.00000   2.25000
133  -2.70000   0.00000   1.80000
134  -2.70000  -0.30000   1.80000
135  -3.00000  -0.30000   1.80000
136  -3.00000   0.00000   1.80000
137  -1.50000   0.30000   2.25000
138  -1.60000   0.30000   2.02500
139  -2.50000   0.30000   2.25000
140  -2.30000   0.30000   2.02500
141  -3.00000   0.30000   2.25000
142  -2.70000   0.30000   2.02500
143  -3.00000   0.30000   1.80000
144  -2.70000   0.30000   1.80000
145  -2.70000   0.00000   1.57500
146  -2.70000  -0.30000   1.57500
147  -3.00000  -0.30000   1.35000
148  -3.00000   0.00000   1.35000
149  -2.50000   0.00000   1.12500
150  -2.50000  -0.30000   1.12500
151  -2.65000  -0.30000   0.93750
152  -2.65000   0.00000   0.93750
153  -2.00000  -0.30000   0.90000
154  -1.90000  -0.30000   0.60000
155  -1.90000   0.00000   0.60000
156  -3.00000   0.30000   1.35000
157  -2.70000   0.30000   1.57500
158  -2.65000   0.30000   0.93750
159  -2.50000   0.30000   1.12500
160  -1.90000   0.30000   0.60000
161  -2.00000   0.30000   0.90000
162   1.70000   0.00000   1.42500
163   1.70000  -0.66000   1.42500
164   1.70000  -0.66000   0.60000
165   1.70000   0.00000   0.60000
166   2.60000   0.00000   1.42500
167   2.60000  -0.66000   1.42500
168   3.10000  -0.66000   0.82500
169   3.10000   0.00000   0.82500
170   2.30000   0.00000   2.10000
171   2.30000  -0.25000   2.10000
172   2.40000  -0.25000   2.02500
173   2.40000   0.00000   2.02500
174   2.70000   0.00000   2.40000
175   2.70000  -0.25000   2.40000
176   3.30000  -0.25000   2.40000
177   3.30000   0.00000   2.40000
178   1.70000   0.66000   0.60000
179   1.70000   0.66000   1.42500
180   3.10000   0.66000   0.82500
181   2.60000   0.66000   1.42500
182   2.40000   0.25000   2.02500
183   2.30000   0.25000   2.10000
184   3.30000   0.25000   2.40000
185   2.70000   0.25000   2.40000
186   2.80000   0.00000   2.47500
187   2.80000  -0.25000   2.47500
188   3.52500  -0.25000   2.49375
189   3.52500   0.00000   2.49375
190   2.90000   0.00000   2.47500
191   2.90000  -0.15000   2.47500
192   3.45000  -0.15000   2.51250
193   3.45000   0.00000   2.51250
194   2.80000   0.00000   2.40000
195   2.80000  -0.15000   2.40000
196   3.20000  -0.15000   2.40000
197   3.20000   0.00000   2.40000
198   3.52500   0.25000   2.49375
199   2.80000   0.25000   2.47500
200   3.45000   0.15000   2.51250
201   2.90000   0.15000   2.47500
202   3.20000   0.15000   2.40000
203   2.80000   0.15000   2.40000
204   0.00000   0.00000   3.15000
205   0.00000  -0.00200   3.15000
206   0.00200   0.00000   3.15000
207   0.80000   0.00000   3.15000
208   0.80000  -0.45000   3.15000
209   0.45000  -0.80000   3.15000
210   0.00000  -0.80000   3.15000
211   0.00000   0.00000   2.85000
212   0.20000   0.00000   2.70000
213   0.20000  -0.11200   2.70000
214   0.11200  -0.20000   2.70000
215   0.00000  -0.20000   2.70000
216  -0.00200   0.00000   3.15000
217  -0.45000  -0.80000   3.15000
218  -0.80000  -0.45000   3.15000
219  -0.80000   0.00000   3.15000
220  -0.11200  -0.20000   2.70000
221  -0.20000  -0.11200   2.70000
222  -0.20000   0.00000   2.70000
223   0.00000   0.00200   3.15000
224  -0.80000   0.45000   3.15000
225  -0.45000   0.80000   3.15000
226   0.00000   0.80000   3.15000
227  -0.20000   0.11200   2.70000
228  -0.11200   0.20000   2.70000
229   0.00000   0.20000   2.70000
230   0.45000   0.80000   3.15000
231   0.80000   0.45000   3.15000
232   0.11200   0.20000   2.70000
233   0.20000   0.11200   2.70000
234   0.40000   0.00000   2.55000
235   0.40000  -0.22400   2.55000
236   0.22400  -0.40000   2.55000
237   0.00000  -0.40000   2.55000
238   1.30000   0.00000   2.55000
239   1.30000  -0.72800   2.55000
240   0.72800  -1.30000   2.55000
241   0.00000  -1.30000   2.55000
242   1.30000   0.00000   2.40000
243   1.30000  -0.72800   2.40000
244   0.72800  -1.30000   2.40000
245   0.00000  -1.30000   2.40000
246  -0.22400  -0.40000   2.55000
247  -0.40000  -0.22400   2.55000
248  -0.40000   0.00000   2.55000
249  -0.72800  -1.30000   2.55000
250  -1.30000  -0.72800   2.55000
251  -1.30000   0.00000   2.55000
252  -0.72800  -1.30000   2.40000
253  -1.30000  -0.72800   2.40000
254  -1.30000   0.00000   2.40000
255  -0.40000   0.22400   2.55000
256  -0.22400   0.40000   2.55000
257   0.00000   0.40000   2.55000
258  -1.30000   0.72800   2.55000
259  -0.72800   1.30000   2.55000
260   0.00000   1.30000   2.55000
261  -1.30000   0.72800   2.40000
262  -0.72800   1.30000   2.40000
263   0.00000   1.30000   2.40000
264   0.22400   0.40000   2.55000
265   0.40000   0.22400   2.55000
266   0.72800   1.30000   2.55000
267   1.30000   0.72800   2.55000
268   0.72800   1.30000   2.40000
269   1.30000   0.72800   2.40000
270   0.00000   0.00000   0.00000
271   1.50000   0.00000   0.15000
272   1.50000   0.84000   0.15000
273   0.84000   1.50000   0.15000
274   0.00000   1.50000   0.15000
275   1.50000   0.00000   0.07500
276   1.50000   0.84000   0.07500
277   0.84000   1.50000   0.07500
278   0.00000   1.50000   0.07500
279   1.42500   0.00000   0.00000
280   1.42500   0.79800   0.00000
281   0.79800   1.42500   0.00000
282   0.00000   1.42500   0.00000
283  -0.84000   1.50000   0.15000
284  -1.50000   0.84000   0.15000
285  -1.50000   0.00000   0.15000
286  -0.84000   1.50000   0.07500
287  -1.50000   0.84000   0.07500
288  -1.50000   0.00000   0.07500
289  -0.79800   1.42500   0.00000
290  -1.42500   0.79800   0.00000
291  -1.42500   0.00000   0.00000
292  -1.50000  -0.84000   0.15000
293  -0.84000  -1.50000   0.15000
294   0.00000  -1.50000   0.15000
295  -1.50000  -0.84000   0.07500
296  -0.84000  -1.50000   0.07500
297   0.00000  -1.50000   0.07500
298  -1.42500  -0.79800   0.00000
299  -0.79800  -1.42500   0.00000
300   0.00000  -1.42500   0.00000
301   0.84000  -1.50000   0.15000
302   1.50000  -0.84000   0.15000
303   0.84000  -1.50000   0.07500
304   1.50000  -0.84000   0.07500
305   0.79800  -1.42500   0.00000
306   1.42500  -0.79800   0.00000`
}

function setup() {
    w = 690
    h = 450

    createCanvas(w, h);
    noStroke()
    background(0);
    fr = frameRate()
    
}

class Point {
    constructor(x, y, z) {
      this.x = x;
      this.y = y;
      this.z = z;

      this.rx = x
      this.ry = y
      this.rz = z

    }
    render() {
        this.dist = getDist(this.x, this.y, 0, 0)

        fill(0 + this.ry,this.rx + 50,this.rz + 50)

        // Rotation Matrix
        var x = document.getElementById("motionmatrix");
        if (mmatrix == true) {
            x.style.display = "inline";
            try{
            this.rx = (this.x * eval($("#mx1").val())) + 
            (this.y * eval($("#my1").val())) + 
            (this.z * eval($("#mz1").val()))

    
            this.ry = (this.x * eval($("#mx2").val())) + 
            (this.y * eval($("#my2").val())) + 
            (this.z * eval($("#mz2").val()))
    
            this.rz = (this.x * eval($("#mx3").val())) + 
            (this.y * eval($("#my3").val())) + 
            (this.z * eval($("#mz3").val()))
            } catch {
                0;
            }
        } else {
            x.style.display = "none";
            this.rx = (cos(t) * this.x) - (sin(t) * this.y)
            this.ry = (sin(t) * this.x) + (cos(t) * this.y)
        }

        fill(0 + this.ry,this.rx + 50,this.rz + 50)
        
        // Rotation Matrix

        ellipse(
            // Projection Matrix
            (this.rx * eval($("#px1").val())) + 
            (this.ry * eval($("#py1").val())) + 
            (this.rz * eval($("#pz1").val())),

            (this.rx * eval($("#px2").val())) + 
            (this.ry * eval($("#py2").val())) + 
            (this.rz * eval($("#pz2").val()))
            // End Projection Matrix
            
        ,(Math.max(-1 * this.ry, 1) / 30) + 5,
         (Math.max(-1 * this.ry, 1) / 30) + 5)
    }
}

function solveMatrix(prefix, xrange, yrange) {

}

function getDist(x1, y1, x2, y2) {
    return Math.sqrt(Math.pow(x1-x2, 2) + Math.pow(y1-y2, 2))
}

//$(function () {
   // $.get('./points.txt', function (data) {
        data = data.split("\n")
        
        for(let k = 0; k < data.length; k++) {
            data[k] = data[k].replace(/  +/g, " ")
            data[k] = data[k].split(" ")
            data[k].splice(0, 1);

        }

        for (let i=0;i<data.length;i++){
            p = new Point(data[i][0] * 85, data[i][1] * 85, (data[i][2] * 85))
            points.push(p)
        }
    //});
//});



function draw() {
    frame ++
    background(0);
    if (frame % 50 == 0 || frame == 2) {
        fr = Math.floor(frameRate())
        
    }
    if (frame % 10 == 0 || frame == 2) {
        mmatrix = $("#mmatrix").is(":checked")
    }
    
    fill(255)
    textSize(16)
    text("FPS: " + fr, 10, 20);

    translate(w/2 + xoff, h - 82 + yoff);
    scale(Math.max(s, 0), Math.min(0, -s))

    
    for(let i = 0; i < points.length; i++) {
        points[i].render()
    }
    t += 0.015
}

function mouseWheel(event) {
    s -= event.delta / 1140
}

function mousePressed() {
    startX = mouseX;
    startY = mouseY;
}

function mouseDragged() {
    
   xoff -= startX - mouseX;
   yoff -= startY - mouseY;
    startX = mouseX;
    startY = mouseY;
}

function windowResized() {
    background(0);
    w = 690
    h = 450
    resizeCanvas(w, h);
}